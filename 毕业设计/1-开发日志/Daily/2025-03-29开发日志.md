---
tags:
  - Log
created: 2025-03-29 17:42
modified: 2025-03-29 17:42
---
## 2024-03-21 å¼€å‘æ—¥å¿—

### ğŸ¯ ä»Šæ—¥ç›®æ ‡
- [x] å®ç°åŸºäºè§’è‰²çš„åŠ¨æ€è·¯ç”±æ§åˆ¶
- [x] ä¼˜åŒ–ç™»å½•æµç¨‹ä¸­çš„è·¯ç”±ç”Ÿæˆé€»è¾‘
- [x] è§£å†³è·¯ç”±é‡å®šå‘å¾ªç¯é—®é¢˜

### ğŸ“ å®Œæˆæƒ…å†µ
- ä¼˜åŒ–ç™»å½•æµç¨‹ä¸­çš„è·¯ç”±ç”Ÿæˆ
  - ä»£ç ä½ç½®ï¼š`frontend/src/pages/login/index.vue#L45-65`
  - ç›¸å…³æ–‡æ¡£ï¼šåœ¨ç™»å½•æˆåŠŸåï¼Œå…ˆè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç­‰å¾… permission store åˆå§‹åŒ–ï¼Œç„¶åè®¾ç½®åŠ¨æ€è·¯ç”±ï¼Œæœ€åè·³è½¬åˆ°é¦–é¡µ

- ç®€åŒ–è·¯ç”±å®ˆå«é€»è¾‘
  - ä»£ç ä½ç½®ï¼š`frontend/src/router/guard.ts#L12-45`
  - ç›¸å…³æ–‡æ¡£ï¼šåˆ é™¤äº†è·¯ç”±å®ˆå«ä¸­é‡å¤çš„è·¯ç”±ç”Ÿæˆä»£ç ï¼Œä¿ç•™äº†å¿…è¦çš„æƒé™æ£€æŸ¥å’Œé”™è¯¯å¤„ç†

### â— é‡åˆ°çš„é—®é¢˜
- **é—®é¢˜æè¿°**ï¼š
  1. ç®¡ç†å‘˜ç¬¬ä¸€æ¬¡ç™»å½•æ—¶åŠ¨æ€è·¯ç”±æœªæ­£ç¡®ç”Ÿæˆ
  2. ç™»å½•åå‡ºç°è·¯ç”±é‡å®šå‘å¾ªç¯
  3. è·¯ç”±å®ˆå«ä¸­çš„è·¯ç”±ç”Ÿæˆé€»è¾‘ä¸ç™»å½•æ—¶çš„è·¯ç”±ç”Ÿæˆé‡å¤

- **è§£å†³æ–¹æ¡ˆ**ï¼š
  1. åœ¨ç™»å½•æ—¶ç¡®ä¿ç”¨æˆ·ä¿¡æ¯è·å–å’Œè·¯ç”±ç”Ÿæˆçš„é¡ºåºæ­£ç¡®
  2. ä¿®æ”¹è·¯ç”±å®ˆå«ï¼Œé¿å…é‡å¤ç”Ÿæˆè·¯ç”±
  3. ä¼˜åŒ–è·¯ç”±è·³è½¬é€»è¾‘ï¼Œä½¿ç”¨ `replace: true` é¿å…å†å²è®°å½•å †ç§¯

- **å…³è”è®°å½•**ï¼š
  - `frontend/src/router/guard.ts`
  - `frontend/src/pages/login/index.vue`
  - `frontend/src/pinia/stores/permission.ts`

### ğŸŒ± æ˜æ—¥è®¡åˆ’
- [ ] å®Œå–„è·¯ç”±æƒé™æ§åˆ¶æ–‡æ¡£
- [ ] æ·»åŠ è·¯ç”±åŠ è½½çŠ¶æ€æç¤º
- [ ] ä¼˜åŒ–è·¯ç”±åˆ‡æ¢åŠ¨ç”»

### ğŸ“Œ ä¸´æ—¶ç¬”è®°
```typescript
// è·¯ç”±å®ˆå«ä¸­çš„å…³é”®é€»è¾‘
if (!getToken()) {
  if (isWhiteList(to)) return true
  return LOGIN_PATH
}

if (to.path === LOGIN_PATH) {
  return true
}

if (userStore.roles.length !== 0) {
  return true
}

// è·å–ç”¨æˆ·ä¿¡æ¯å’Œè®¾ç½®è·¯ç”±
await userStore.getInfo()
const roles = userStore.roles
routerConfig.dynamic ? permissionStore.setRoutes(roles) : permissionStore.setAllRoutes()
permissionStore.addRoutes.forEach(route => {
  if (!router.hasRoute(route.name as string)) {
    router.addRoute(route)
  }
})
return { ...to, replace: true }
```
```