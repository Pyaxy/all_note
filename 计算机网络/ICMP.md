---
tags:
  - 计算机网络
  - 4️⃣0️⃣8️⃣
---
- 网际控制报文协议**_ICMP_**，**Internet** **Control** **Message** **Protocol**
- 主要用于报告出错和测试等控制信息
- **ICMP**位于**IP**层，**ICMP**报文是封装在**IP**包中传输的
- ![](http://oss.pyaxy.xyz/img/ICMP%25E6%258A%25A5%25E6%2596%2587%25E6%25A0%25BC%25E5%25BC%258F.png)
- **ICMP**报文类型
	- **ICMP** 报文有**9**种，可分为差错报告报文和询问报文两类
		- 差错报告报文
			- **Destination unreachable**：终点不可达，路由器或主机无法传输报文时向源主机发送此报文
			- **Source quench**：源点抑制，路由器或主机由于拥塞丢弃报文时，向源主机发送此报文，使其放慢发送速度
			- **Time exceeded**：超时，当报文的**TTL**字段为**0**时，路由器丢弃报文，并向源主机发送此报文
			- **Parameter problem**：参数问题，路由器或主机收到的报文中头部有非法字段时，丢弃数据包，并向源主机发送此报文
			- **Redirect**：重定向，路由器向主机发送此报文告知路由改变，主机下次发送数据报给另外的路由器
		- 询问报文
			- **Echo request / reply**：回声探测，用于测试网络连通性
			- **Timestamp request / reply**：请求时间，可用于时间同步
- **ICMP**应用举例
	- **Ping**
		- 用来测试两个主机之间的连通性
		- 采用**ICMP echo request / reply**报文
	- **Traceroute / Tracert**
		- 用来测试到另一台主机所经过的路由信息
		- 采用**ICMP**超时报告报文
			- 逐个发出**UDP**报文，其**IP**包头中的**TTL**字段分别设为**1, 2, 3, …**，直到到达目的主机
			- 报文路由路径上的路由器会返回**ICMP**超时报文，从该报文即可得知路由器**IP**地址