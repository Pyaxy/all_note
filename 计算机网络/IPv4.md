# IP数据报格式
- 一个 **IP**包由**头部**和**数据**两部分组成
- 头部：**20**字节的固定字段 **+ 0**到多个可选字段
	- ![[IP数据报格式.png]]
	- **Version**字段：**4bit**，**IP** 协议的版本，目前的 **IP** 协议版本号为 **4**（**IPv4**）
	- **IHL**：**4bit**，**IP**包头长度，最小**5**，最大**15**，单位为**word(32bit)**。
	> **IP**首部的前两个字节一般都以**0x45**开头，做题时可用于定位**IP**数据报开头。
	- **Type of service**：**1**字节，服务类型，目前很多路由器忽略该字段，为全**0**。
	- **Total Length**：**2**字节，**IP**包总长度**(**含头部和数据**)**，单位为字节。因此**IP**包的最大长度为 **65535** 字节。
	- **Identification**：**2**字节，标识，是一个计数器，用来产生**IP**包的标识。
		- 超过数据链路层**MTU(Maximum Transmission Unit)**的**IP**包要分片传输。
		- 分片的多个包具有相同的标示，便于接收端重组。
	- **DF**：**1bit**，**Don’t Fragment**，当**DF=0** 时允许分片。
	- **MF**：**1bit**，**More Fragment**，**MF=1**表示后面“还有分片”；**MF=0**表示最后一个分片
	- **Fragment offset**：**13bit**，片偏移，较长的包在分片后，某片在原分组中的相对位置，以**8**字节为单位。([[IP数据报分片例题]])
	- ==**Time to live(TTL)**==：**1**字节，生存时间，**IP**包在网络中可通过的路由器个数的最大值。
		- **IP**包每经过一个路由器**TTL**减**1**，为**0**则丢弃，并向源主机发送警告包（[[ICMP]]协议）。
	- **Protocol**：**8bit**，协议字段，该包中数据部分的协议类型，即上层协议类型 → 该字段决定了该包将交由哪里。
		- 值为1表示[[ICMP]]
		- 值为6表示**TCP**
		- 值位17表示**UDP**
	- **Header checksum**：**2**字节，包头校验和**(**注意：只针对包头**)**[[IP数据报包头校验和算法]]
	- **Source address**：**4**字节，源**IP**地址
	- **Destination address**：**4**字节，目的**IP**地址
	- 选项字段：以**4**字节为单位，最长**40**字节。实际网络中很少使用
# 分类的IP地址
- **IP**地址被分为**_A, B, C, D, E_**五类，每一类地址都包含网络号**(net-id)**和主机号**(host-id)**两个字段
	- **IP** 地址 **::= { <**网络号**>, <**主机号**>}**
- ![[IP 地址中的网络号字段和主机号字段.png]]
- **IP** 地址的表示方法：点分十进制记法**(dotted decimal notation)**
	- **全0、全1**的IP地址的用途
		- 全**0**表示本网络或本主机
		- 全**1**表示广播地址
	- 三类网络的IP地址使用范围

| 网络类别 | 最大网络数    | 第一个可用的网络号   | 最后一个可用的网络号      | 每个网络中的最大主机数 |
| ---- | -------- | ----------- | --------------- | ----------- |
| A    | $2^7-2$  | $1.0.0.0$   | $126.0.0.0$     | $2^{24}-2$  |
| B    | $2^{14}$ | $128.0.0.0$ | $191.255.0.0$   | $2^{16}-2$  |
| C    | $2^{21}$ | $192.0.0.0$ | $223.255.255.0$ | $2^8-2$     |
> A类地址网络数减2的原理在于全0不能用，全1表示环回地址($127.*.*.*$)