# ARQ协议
- 在有噪声信道中，帧在传输过程中可能出错。
- 解决方法---ARQ(Automatic Repeat reQuest)自动请求重传协议
	- 校验和：使接收方能够检测帧是否出错，详见[[差错控制]]
	- 确认帧：使发送方知道帧已被正确接收，ACK帧
	- 超时重发：发送方在规定时间内未收到确认帧，则重发帧
	- 帧序号：保证接收方不会重复接收帧
	- ==[[基本数据链路层协议#停止-等待协议（S-W）|停止等待（S-W）协议]]、[[基本数据链路层协议#后退N帧协议（GBN）|后退N帧（GBN）协议]]、[[基本数据链路层协议#选择重传协议（SR）|选择重传协议(SR)]]==都使用了ARQ协议，即超时自动重传，而后两者使用了连续ARQ协议，即可以连续重传。
# 滑动窗口
- 传输链路存在时延，而**ARQ**协议在同一时刻仅有一个帧在链路上传输**(**数据帧或确认帧**)**，其对信道的利用率较低。
	- ARQ协议的信道利用率较低
	![ARQ协议信道利用率](http://oss.pyaxy.xyz/img/ARQ%E5%8D%8F%E8%AE%AE%E4%BF%A1%E9%81%93%E5%88%A9%E7%94%A8%E7%8E%87.png)
- 滑动窗口协议原理**(sliding window protocol)**
	- 允许发送方连续发送多个帧
	- 通过滑动窗口实现流量控制
	- 发送窗口$W_T$
		- 发送窗口内的序列号代表允许它发送的帧
		- 发送窗口下沿被标记为确认时，向前移动
	- 接收窗口$W_R$
		- 接收窗口内的序列号代表它可以接收的帧
		- 接收窗口下沿成功接收时，向前移动
	- 发送窗口$W_T$和接收窗口$W_R$的宽度：
		$$W_T+W_R\leq2^n$$
## 停止-等待协议（S-W）
- 滑动窗口机制
	- 发送窗口$W_T=1$和接收窗口$W_R=1$
	- ==该协议使用了滑动窗口机制，但不能称为滑动窗口协议==
- 确认机制
	- 使用确认帧ACK_i
	- 接收方收到第i号帧，且检测没有差错，则需返回确认帧ACK_i
- 重传机制
	- 超时重传
- 帧编号
	- 只需要1个bit来给帧编号

## 后退N帧协议（GBN）
- 滑动窗口机制
	- 发送窗口$W_T\gt 1$和接收窗口$W_R=1$
- 确认机制
	- 使用确认帧ACK_i
	- 接收方收到第i号帧，且检测没有差错，则需返回确认帧ACK_i。
	- ==GBN协议中，接收方可以累计确认：当连续收到多个数据帧时，只需发送最后一个成功接收到帧的确认帧。==
		- 即：**ACK_i表示第i帧及其之前的帧都已经成功接收**
- 重传机制
	- 超时重传
	- ==当没有收到第i号帧的ACK帧时，**重传窗口内i号帧之后的所有帧**==，因此被称为GBN
- 帧编号
	- 需要n个bit来给帧编号
- 要点
	- 收到不在接收窗口内的帧时，丢弃此帧，并返回已接收的最后一个正确帧的ACK
	- 信道利用率计算：
		- $$\eta = \frac{N\times T_D}{T_D+RTT+T_A}\leq1$$
		- 分子表示==发送大小为N的滑动窗口==内的数据帧的耗时，分母表示发送第一个帧到接收第一个帧到确认帧所耗费的时间。
		- ![GBN信道利用率分析](http://oss.pyaxy.xyz/img/GBN%E4%BF%A1%E9%81%93%E5%88%A9%E7%94%A8%E7%8E%87%E5%88%86%E6%9E%90.png)
		- 
## 选择重传协议（SR）
- 滑动窗口机制
	- 发送窗口$W_T\gt 1$和接收窗口$W_R\gt1$
- 确认机制
	- 使用确认帧ACK_i
		- 接收方收到第i号帧，且检测没有差错，则需返回确认帧ACK_i。
	- 使用否认帧NAK_i
		- ==接收方收到第i号帧，检测出差错，则需返回否认帧NAK_i。==
		- ==可以在检测出错时直接请求重传，避免等待发送方计数器超时再重传，节约了时间。==
- 重传机制
	- 超时重传ACK帧
	- 请求重传NAK帧
- 帧编号
	- 需要n个bit来给帧编号
	- $W_R\leq W_T$，接收窗口小于等于发送窗口，等于时效率最高
- 要点
	- 与GBN不同，SR协议必须每个帧都要发送确认信号。
	- 信道利用率计算同**GBN**协议。
